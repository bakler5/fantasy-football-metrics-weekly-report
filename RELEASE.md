# Fantasy Football Metrics Weekly Report Deployment

1. *(Optional)* Clear virtual machine of old requirements:
    ```shell
    pip uninstall -y -r <(pip freeze)
    ```
   
2. *(Optional)* Check `requirements.txt` and `requirement-dev.txt` for latest dependency versions.

3. *(Optional)* Update virtual machine with the latest dependencies:
    ```shell
    pip install -r requirements.txt -r requirements-dev.txt
    ```
   
4. *(Optional)* Run *all* `pytest` tests:
    ```shell
    python -m pytest
    ```
   
5. *(Optional)* Run *all* `pytest` tests *verbosely*:
    ```shell
    python -m pytest -v -s
    ```

6. *(Optional)* Test Python support using [act](https://github.com/nektos/act) for GitHub Actions:

    ```shell
    act -j build
    ```

    ***Note***: If `act` is unable to locate Docker, make sure that the required `/var/run/docker.sock` symlink exists. If it does not, you can fix it by running:
    
    ```shell
    sudo ln -s "$HOME/.docker/run/docker.sock" /var/run/docker.sock`
    ```

7. Update the Docker `compose.yaml` file with the latest version of the app.

8. Build and push a new Docker image for the app (see [DEPLOYMENT.md](./docker/DEPLOYMENT.md)).

9. *(Optional)* Create a new git branch if creating a release:
   ```shell
   git checkout -b release/vX.X.X
   ```

10. Create a git commit:
    ```shell
    git add .
    git commit -m 'commit message'
    ```
    
11. Update the git tag (format: `git tag -a [tag_name/version] -m [message]`):
    ```shell
    git tag -a v1.0.0 -m 'first release'
    git push origin --tags
    ```

12. *(Optional)* View git tags:
    ```shell
    git tag -l --sort=v:refname -n99
    ```

13. Update `fantasy-football-metrics-weekly-report` GitHub repository:

    * *(Optional)* If creating a release:    
        ```shell
        git push -u origin release/vX.X.X
        ```
    
    * If updating `main`:
        ```shell
        git push
        ```

14. Open a pull request (PR) with the `release/vX.X.X` branch, allow GitHub actions to complete successfully, draft release notes, and merge it.

15. Go to the [FFMWR Releases page](https://github.com/uberfastman/fantasy-football-metrics-weekly-report/releases) and draft a new release using the above git tag.
## Private Fork Migration Notes

This repository is a private fork intended for continued development and maintenance independent of the original project.

Key changes in this fork:

- Update checks disabled: automatic GitHub update checks and remote operations are removed. The app no longer fetches or switches branches. (`check_for_updates=False` by default.)
- Branding: CLI epilog and PDF footer updated for this fork.
- Footer customization: New report setting `FOOTER_TEXT` controls the PDF footer text. Defaults to "Generated by Josh Bachler for the Josh Koch Memorial League".
- Donation elements optional: `SHOW_DONATION_FOOTER` controls whether donation links/QRs appear in the PDF header/footer. Defaults to `False`.
- Prompts: `.env` creation flow now offers to set `FOOTER_TEXT` and `SHOW_DONATION_FOOTER` interactively.
- Robustness: Input prompts no longer use recursion; fixed a recursion return path in `select_league`; HTTP queries now include timeouts and error handling.
- Metrics: Power ranking uses arithmetic mean (previously truncated); coaching efficiency ties-at-first detection improved.

Upgrade guidance:

- If you have an existing `.env`, new fields will use defaults unless you add them. To customize, set:
  - `FOOTER_TEXT="Your custom text"`
  - `SHOW_DONATION_FOOTER=True` (only if you want donation links/QRs)
- No action is required for upstream updates; the app will no longer contact remotes.
